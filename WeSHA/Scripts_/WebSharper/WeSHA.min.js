(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;a=window;b=a.WeSHA=a.WeSHA||{};c=b.Client=b.Client||{};d=c.HAMessageItem=c.HAMessageItem||{};e=c.HAModel=c.HAModel||{};f=a.StartupCode$WeSHA$Client=a.StartupCode$WeSHA$Client||{};g=a.WeSHA_JsonEncoder=a.WeSHA_JsonEncoder||{};h=a.WeSHA_JsonDecoder=a.WeSHA_JsonDecoder||{};i=a.IntelliFactory;j=i&&i.Runtime;k=a.WebSharper;l=k&&k.UI;m=l&&l.Next;n=m&&m.Var;o=k&&k.Seq;p=k&&k.List;q=k&&k.Operators;r=m&&m.Key;s=k&&k.Control;t=s&&s.FSharpEvent;u=k&&k.Charting;v=u&&u.Chart;w=m&&m.Doc;x=k&&k.Concurrency;y=k&&k.Community;z=y&&y.Suave;A=z&&z.WebSocket;B=A&&A.Client;C=B&&B.WithEncoding;D=m&&m.AttrProxy;E=m&&m.View;F=u&&u.Renderers;G=F&&F.ChartJs;H=u&&u.LiveChart;I=m&&m.ListModel;J=k&&k.Json;K=J&&J.Provider;d=c.HAMessageItem=j.Class({UpdateValue:function(L){var M,N,O;M=this;n.Set(this.value,L);this.values.push(L);this.values.length>10?N=this.values.shift():void 0;O=function(P,Q){return M.chart.__UpdateData(P,function(){return Q;});};(function(P){o.iteri(O,P);}(this.values));this.source.event.Trigger(L);}},null,d);d.Create=function(L){var M,N,O;M=p.ofSeq(o.delay(function(){return o.map(function(){return 0;},q.range(0,9));}));return d.New(r.Fresh(),L,n.Create$1(0),new t.New(),(N=[],(O=function(P){N.push(P);},function(P){o.iter(O,P);}(M),N)),v.Line(M));};d.New=function(L,M,N,O,P,Q){return new d({Key:L,queue:M,value:N,source:O,values:P,chart:Q});};e.New=function(L){return{HAItems:L};};c.Description=function(){var L;L=[w.TextNode("A to-do list application.")];return w.Element("div",[],L);};c.Main=function(L){var M,N,O;M=w.Element("h1",[],[]);c.procSockets(L,M);N=(O=function(P){return P.Key;},function(P){return w.ConvertBy(O,c.RenderHAItem,P);}(c.haItems().HAItems.v));return c.TodoExample(w.Element("div",[],[M,N]));};c.procSockets=function(L,M){var N;N=x.Delay(function(){var O;O=C.ConnectStateful(function(P){return a.JSON.stringify((g.j())(P));},function(P){return(h.j())(a.JSON.parse(P));},L,function(){return x.Delay(function(){return x.Return([0,function(P){return function(Q){return x.Delay(function(){var R,S,T,U,V,W,X,Y;return Q.$==3?(a.console.log("Connection closed."),x.Return(P)):Q.$==2?(a.console.log("WebSocket connection open."),x.Return(P)):Q.$==1?(a.console.log("WebSocket connection error!"),x.Return(P)):(R=Q.$0,(S=R.$==0?(T=R.$0[1],(U=R.$0[0],(a.console.log("Message received:"+U+" "+a.String(T)),V=(W=c.haItems().HAItems.TryFind(function(Z){return Z.queue===U;}),(W!=null?W.$==1:false)?W.$0:(X=d.Create(U),(c.haItems().HAItems.Append(X),a.console.log("New item"),X))),a.console.log("Value added:"+a.String(T)),V.UpdateValue(T),x.Return(null)))):(M.SetText(a.String(P)+R.$0),x.Return(null)),(Y=x.Delay(function(){return x.Return(P+1);}),x.Combine(S,Y))));});};}]);});});return x.Bind(O,function(){return x.Return(null);});});x.Start(N,null);};c.RenderHAItem=function(L){var M,N,O,P,Q;M=[(N=[(O=[D.Create("class","bigvalue")],(P=[w.TextView(E.Map(a.String,L.value.v))],w.Element("div",O,P)))],w.Element("td",[],N)),(Q=[G.Render$5(L.chart,null,null,null)],w.Element("td",[],Q))];return w.Element("tr",[],M);};c.renderChart=function(L){var M;M=H.Line(L.event).__WithTitle("");return G.Render$5(M,null,null,{$:1,$0:10});};c.haItems=function(){f.$cctor();return f.haItems;};c.TodoExample=function(L){var M,N;M=[D.Create("class","table table-hover")];N=[w.Element("tbody",[],[L])];return w.Element("table",M,N);};f.$cctor=j.Cctor(function(){var L;f.haItems=e.New((L=new p.T({$:0}),I.Create(function(M){return M.Key;},L)));f.$cctor=a.ignore;});g.j=function(){return g._v?g._v:g._v=(K.EncodeUnion(void 0,{str:0},[["RequestRefresh",[["$0","str",K.Id(),0]]]]))();};h.j=function(){return h._v?h._v:h._v=(K.DecodeUnion(void 0,"type",[["queue_value",[["$0","Item",K.DecodeTuple([K.Id(),K.Id()]),0]]],["string",[["$0","value",K.Id(),0]]]]))();};}());
